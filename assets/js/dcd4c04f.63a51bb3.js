"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics=globalThis.webpackChunkphysical_ai_humanoid_robotics||[]).push([[603],{852(e,r,n){n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"module-1/python-rclpy","title":"Python with rclpy","description":"Comprehensive guide to developing ROS 2 nodes using Python and rclpy","source":"@site/docs/module-1/python-rclpy.md","sourceDirName":"module-1","slug":"/module-1/python-rclpy","permalink":"/physical-ai/docs/module-1/python-rclpy","draft":false,"unlisted":false,"editUrl":"https://github.com/physical-ai-textbook/book-ai/tree/main/docs/module-1/python-rclpy.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"python-rclpy","title":"Python with rclpy","sidebar_position":4,"description":"Comprehensive guide to developing ROS 2 nodes using Python and rclpy","keywords":["rclpy","python","ros2 python","robotics programming","python nodes"]},"sidebar":"textbook","previous":{"title":"Nodes, Topics, Services","permalink":"/physical-ai/docs/module-1/nodes-topics-services"},"next":{"title":"URDF for Humanoids","permalink":"/physical-ai/docs/module-1/urdf-humanoids"}}');var i=n(4848),l=n(8453);const t={id:"python-rclpy",title:"Python with rclpy",sidebar_position:4,description:"Comprehensive guide to developing ROS 2 nodes using Python and rclpy",keywords:["rclpy","python","ros2 python","robotics programming","python nodes"]},a="Python with rclpy",o={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"What is rclpy?",id:"what-is-rclpy",level:3},{value:"Installation and Setup",id:"installation-and-setup",level:3},{value:"Basic Node Structure",id:"basic-node-structure",level:3},{value:"Creating Nodes with rclpy",id:"creating-nodes-with-rclpy",level:2},{value:"Basic Node Implementation",id:"basic-node-implementation",level:3},{value:"Node with Multiple Communication Patterns",id:"node-with-multiple-communication-patterns",level:3},{value:"Publishers and Subscribers",id:"publishers-and-subscribers",level:2},{value:"Advanced Publisher Features",id:"advanced-publisher-features",level:3},{value:"Advanced Subscriber Features",id:"advanced-subscriber-features",level:3},{value:"Services and Clients",id:"services-and-clients",level:2},{value:"Service Implementation",id:"service-implementation",level:3},{value:"Service Client Implementation",id:"service-client-implementation",level:3},{value:"Parameters",id:"parameters",level:2},{value:"Parameter Declaration and Usage",id:"parameter-declaration-and-usage",level:3},{value:"Timers and Callbacks",id:"timers-and-callbacks",level:2},{value:"Advanced Timer Usage",id:"advanced-timer-usage",level:3},{value:"Exception Handling and Error Management",id:"exception-handling-and-error-management",level:2},{value:"Robust Error Handling",id:"robust-error-handling",level:3},{value:"Package Structure and Organization",id:"package-structure-and-organization",level:2},{value:"Creating a ROS 2 Python Package",id:"creating-a-ros-2-python-package",level:3},{value:"setup.py for Python Package",id:"setuppy-for-python-package",level:3},{value:"Debugging Techniques",id:"debugging-techniques",level:2},{value:"Debugging with Logging",id:"debugging-with-logging",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Efficient Message Handling",id:"efficient-message-handling",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Code Organization",id:"code-organization",level:3},{value:"Performance Tips",id:"performance-tips",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Learning Objectives Review",id:"learning-objectives-review",level:2},{value:"Practical Exercise",id:"practical-exercise",level:2},{value:"Assessment Questions",id:"assessment-questions",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"python-with-rclpy",children:"Python with rclpy"})}),"\n",(0,i.jsx)(r.p,{children:"This chapter provides a comprehensive guide to developing ROS 2 nodes using Python and the rclpy client library. Python is an excellent choice for rapid prototyping and development in robotics."}),"\n",(0,i.jsx)(r.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Master the rclpy client library for ROS 2 Python development"}),"\n",(0,i.jsx)(r.li,{children:"Create complex nodes with multiple publishers, subscribers, and services"}),"\n",(0,i.jsx)(r.li,{children:"Implement advanced features like parameters, timers, and callbacks"}),"\n",(0,i.jsx)(r.li,{children:"Debug and optimize Python-based ROS 2 nodes"}),"\n",(0,i.jsx)(r.li,{children:"Structure Python packages for ROS 2 projects"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,i.jsx)(r.h3,{id:"what-is-rclpy",children:"What is rclpy?"}),"\n",(0,i.jsx)(r.p,{children:"rclpy is the Python client library for ROS 2. It provides a Python API to ROS 2 concepts such as nodes, publishers, subscribers, services, and parameters. It's built on top of the C client library (rcl) and provides Pythonic interfaces to ROS 2 functionality."}),"\n",(0,i.jsx)(r.h3,{id:"installation-and-setup",children:"Installation and Setup"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"# Install ROS 2 Python packages\r\nsudo apt update\r\nsudo apt install python3-ros-foxy-*\r\n# For Humble Hawksbill, replace 'foxy' with 'humble'\n"})}),"\n",(0,i.jsx)(r.h3,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\ndef main(args=None):\r\n    # Initialize the ROS client library\r\n    rclpy.init(args=args)\r\n\r\n    # Create an instance of your node class\r\n    my_node = MyNodeClass()\r\n\r\n    # Start spinning to process callbacks\r\n    rclpy.spin(my_node)\r\n\r\n    # Destroy the node explicitly (optional)\r\n    my_node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"creating-nodes-with-rclpy",children:"Creating Nodes with rclpy"}),"\n",(0,i.jsx)(r.h3,{id:"basic-node-implementation",children:"Basic Node Implementation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\nclass MinimalPublisher(Node):\r\n    def __init__(self):\r\n        # Initialize the Node class with a name\r\n        super().__init__('minimal_publisher')\r\n\r\n        # Create a publisher\r\n        self.publisher_ = self.create_publisher(String, 'topic', 10)\r\n\r\n        # Create a timer\r\n        timer_period = 0.5  # seconds\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n\r\n        self.i = 0\r\n\r\n    def timer_callback(self):\r\n        msg = String()\r\n        msg.data = f'Hello World: {self.i}'\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f'Publishing: \"{msg.data}\"')\r\n        self.i += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_publisher = MinimalPublisher()\r\n    rclpy.spin(minimal_publisher)\r\n    minimal_publisher.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h3,{id:"node-with-multiple-communication-patterns",children:"Node with Multiple Communication Patterns"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\nfrom std_srvs.srv import SetBool\r\nfrom rclpy.qos import QoSProfile\r\n\r\nclass ComplexNode(Node):\r\n    def __init__(self):\r\n        super().__init__('complex_node')\r\n\r\n        # Publisher\r\n        qos_profile = QoSProfile(depth=10)\r\n        self.publisher_ = self.create_publisher(String, 'status', qos_profile)\r\n\r\n        # Subscriber\r\n        self.subscription = self.create_subscription(\r\n            String,\r\n            'commands',\r\n            self.command_callback,\r\n            qos_profile\r\n        )\r\n\r\n        # Service\r\n        self.srv = self.create_service(SetBool, 'enable', self.enable_callback)\r\n\r\n        # Timer\r\n        self.timer = self.create_timer(1.0, self.status_timer_callback)\r\n\r\n        self.enabled = True\r\n        self.status_counter = 0\r\n\r\n    def command_callback(self, msg):\r\n        self.get_logger().info(f'Received command: {msg.data}')\r\n        if msg.data == 'enable':\r\n            self.enabled = True\r\n        elif msg.data == 'disable':\r\n            self.enabled = False\r\n\r\n    def enable_callback(self, request, response):\r\n        self.enabled = request.data\r\n        response.success = True\r\n        response.message = f'Node {\"enabled\" if self.enabled else \"disabled\"}'\r\n        return response\r\n\r\n    def status_timer_callback(self):\r\n        if self.enabled:\r\n            msg = String()\r\n            msg.data = f'Node operational: {self.status_counter}'\r\n            self.publisher_.publish(msg)\r\n            self.status_counter += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = ComplexNode()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"publishers-and-subscribers",children:"Publishers and Subscribers"}),"\n",(0,i.jsx)(r.h3,{id:"advanced-publisher-features",children:"Advanced Publisher Features"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy, HistoryPolicy, DurabilityPolicy\r\n\r\nclass AdvancedPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('advanced_publisher')\r\n\r\n        # Different QoS profiles for different use cases\r\n        # High-frequency sensor data\r\n        sensor_qos = QoSProfile(\r\n            depth=5,\r\n            reliability=ReliabilityPolicy.BEST_EFFORT,\r\n            durability=DurabilityPolicy.VOLATILE\r\n        )\r\n\r\n        # Critical commands\r\n        command_qos = QoSProfile(\r\n            depth=10,\r\n            reliability=ReliabilityPolicy.RELIABLE,\r\n            durability=DurabilityPolicy.TRANSIENT_LOCAL\r\n        )\r\n\r\n        # Create publishers with different QoS\r\n        self.sensor_pub = self.create_publisher(String, 'sensor_data', sensor_qos)\r\n        self.command_pub = self.create_publisher(String, 'commands', command_qos)\r\n\r\n        # Publisher with custom callback group\r\n        self.status_pub = self.create_publisher(String, 'status', 10)\r\n\r\n        # Timer for publishing\r\n        self.timer = self.create_timer(0.1, self.publish_callback)\r\n\r\n    def publish_callback(self):\r\n        # Publish sensor data\r\n        sensor_msg = String()\r\n        sensor_msg.data = f'Sensor reading: {self.get_clock().now().nanoseconds}'\r\n        self.sensor_pub.publish(sensor_msg)\r\n\r\n        # Publish status\r\n        status_msg = String()\r\n        status_msg.data = f'Node running at {self.get_clock().now().nanoseconds}'\r\n        self.status_pub.publish(status_msg)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    publisher = AdvancedPublisher()\r\n    rclpy.spin(publisher)\r\n    publisher.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h3,{id:"advanced-subscriber-features",children:"Advanced Subscriber Features"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\nfrom rclpy.qos import QoSProfile, ReliabilityPolicy\r\n\r\nclass AdvancedSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('advanced_subscriber')\r\n\r\n        # Multiple subscriptions with different QoS\r\n        qos_sensor = QoSProfile(depth=5, reliability=ReliabilityPolicy.BEST_EFFORT)\r\n        qos_command = QoSProfile(depth=10, reliability=ReliabilityPolicy.RELIABLE)\r\n\r\n        self.sensor_sub = self.create_subscription(\r\n            String,\r\n            'sensor_data',\r\n            self.sensor_callback,\r\n            qos_sensor\r\n        )\r\n\r\n        self.command_sub = self.create_subscription(\r\n            String,\r\n            'commands',\r\n            self.command_callback,\r\n            qos_command\r\n        )\r\n\r\n        # Subscription with custom callback group\r\n        self.status_sub = self.create_subscription(\r\n            String,\r\n            'status',\r\n            self.status_callback,\r\n            10\r\n        )\r\n\r\n        self.sensor_count = 0\r\n        self.command_count = 0\r\n\r\n    def sensor_callback(self, msg):\r\n        self.sensor_count += 1\r\n        self.get_logger().info(f'Sensor message #{self.sensor_count}: {msg.data}')\r\n\r\n    def command_callback(self, msg):\r\n        self.command_count += 1\r\n        self.get_logger().info(f'Command message #{self.command_count}: {msg.data}')\r\n\r\n    def status_callback(self, msg):\r\n        self.get_logger().info(f'Status: {msg.data}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    subscriber = AdvancedSubscriber()\r\n    rclpy.spin(subscriber)\r\n    subscriber.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"services-and-clients",children:"Services and Clients"}),"\n",(0,i.jsx)(r.h3,{id:"service-implementation",children:"Service Implementation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\nfrom std_srvs.srv import SetBool\r\n\r\nclass CalculatorService(Node):\r\n    def __init__(self):\r\n        super().__init__('calculator_service')\r\n\r\n        # Multiple services\r\n        self.add_srv = self.create_service(\r\n            AddTwoInts,\r\n            'add_two_ints',\r\n            self.add_callback\r\n        )\r\n\r\n        self.multiply_srv = self.create_service(\r\n            AddTwoInts,\r\n            'multiply_two_ints',\r\n            self.multiply_callback\r\n        )\r\n\r\n        # State service\r\n        self.state_srv = self.create_service(\r\n            SetBool,\r\n            'set_operation_state',\r\n            self.set_state_callback\r\n        )\r\n\r\n        self.operations_enabled = True\r\n\r\n    def add_callback(self, request, response):\r\n        if self.operations_enabled:\r\n            response.sum = request.a + request.b\r\n            self.get_logger().info(f'{request.a} + {request.b} = {response.sum}')\r\n        else:\r\n            response.sum = 0\r\n            self.get_logger().warn('Operations disabled')\r\n        return response\r\n\r\n    def multiply_callback(self, request, response):\r\n        if self.operations_enabled:\r\n            response.sum = request.a * request.b\r\n            self.get_logger().info(f'{request.a} * {request.b} = {response.sum}')\r\n        else:\r\n            response.sum = 0\r\n            self.get_logger().warn('Operations disabled')\r\n        return response\r\n\r\n    def set_state_callback(self, request, response):\r\n        self.operations_enabled = request.data\r\n        response.success = True\r\n        response.message = f'Operations {\"enabled\" if self.operations_enabled else \"disabled\"}'\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    service = CalculatorService()\r\n    rclpy.spin(service)\r\n    service.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h3,{id:"service-client-implementation",children:"Service Client Implementation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\nfrom std_srvs.srv import SetBool\r\n\r\nclass CalculatorClient(Node):\r\n    def __init__(self):\r\n        super().__init__('calculator_client')\r\n\r\n        # Create clients\r\n        self.add_client = self.create_client(AddTwoInts, 'add_two_ints')\r\n        self.multiply_client = self.create_client(AddTwoInts, 'multiply_two_ints')\r\n        self.state_client = self.create_client(SetBool, 'set_operation_state')\r\n\r\n        # Wait for services\r\n        while not self.add_client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Add service not available, waiting again...')\r\n\r\n        while not self.multiply_client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Multiply service not available, waiting again...')\r\n\r\n        while not self.state_client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('State service not available, waiting again...')\r\n\r\n        # Async calls\r\n        self.send_requests()\r\n\r\n    def send_requests(self):\r\n        # Send add request\r\n        add_request = AddTwoInts.Request()\r\n        add_request.a = 2\r\n        add_request.b = 3\r\n\r\n        self.add_future = self.add_client.call_async(add_request)\r\n        self.add_future.add_done_callback(self.add_response_callback)\r\n\r\n        # Send multiply request\r\n        multiply_request = AddTwoInts.Request()\r\n        multiply_request.a = 4\r\n        multiply_request.b = 5\r\n\r\n        self.multiply_future = self.multiply_client.call_async(multiply_request)\r\n        self.multiply_future.add_done_callback(self.multiply_response_callback)\r\n\r\n    def add_response_callback(self, future):\r\n        try:\r\n            response = future.result()\r\n            self.get_logger().info(f'Add result: {response.sum}')\r\n        except Exception as e:\r\n            self.get_logger().error(f'Service call failed: {e}')\r\n\r\n    def multiply_response_callback(self, future):\r\n        try:\r\n            response = future.result()\r\n            self.get_logger().info(f'Multiply result: {response.sum}')\r\n        except Exception as e:\r\n            self.get_logger().error(f'Service call failed: {e}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    client = CalculatorClient()\r\n    rclpy.spin(client)\r\n    client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsx)(r.h3,{id:"parameter-declaration-and-usage",children:"Parameter Declaration and Usage"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom rcl_interfaces.msg import ParameterDescriptor\r\n\r\nclass ParameterNode(Node):\r\n    def __init__(self):\r\n        super().__init__('parameter_node')\r\n\r\n        # Declare parameters with default values and descriptions\r\n        self.declare_parameter(\r\n            'robot_name',\r\n            'default_robot',\r\n            ParameterDescriptor(description='Name of the robot')\r\n        )\r\n\r\n        self.declare_parameter(\r\n            'max_velocity',\r\n            1.0,\r\n            ParameterDescriptor(description='Maximum velocity in m/s')\r\n        )\r\n\r\n        self.declare_parameter(\r\n            'safety_distance',\r\n            0.5,\r\n            ParameterDescriptor(description='Safety distance in meters')\r\n        )\r\n\r\n        # Declare parameter with constraints\r\n        self.declare_parameter(\r\n            'control_frequency',\r\n            50,\r\n            ParameterDescriptor(description='Control loop frequency in Hz')\r\n        )\r\n\r\n        # Get parameter values\r\n        self.robot_name = self.get_parameter('robot_name').value\r\n        self.max_velocity = self.get_parameter('max_velocity').value\r\n        self.safety_distance = self.get_parameter('safety_distance').value\r\n        self.control_frequency = self.get_parameter('control_frequency').value\r\n\r\n        self.get_logger().info(\r\n            f'Robot: {self.robot_name}, Max vel: {self.max_velocity}, '\r\n            f'Safety dist: {self.safety_distance}, Freq: {self.control_frequency}'\r\n        )\r\n\r\n        # Set up parameter callback\r\n        self.add_on_set_parameters_callback(self.parameter_callback)\r\n\r\n    def parameter_callback(self, params):\r\n        for param in params:\r\n            if param.name == 'max_velocity' and param.type_ == param.Type.DOUBLE:\r\n                if param.value > 5.0:\r\n                    self.get_logger().warn('Max velocity too high!')\r\n                    return rclpy.node.SetParametersResult(successful=False)\r\n\r\n        return rclpy.node.SetParametersResult(successful=True)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = ParameterNode()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"timers-and-callbacks",children:"Timers and Callbacks"}),"\n",(0,i.jsx)(r.h3,{id:"advanced-timer-usage",children:"Advanced Timer Usage"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.timer import Rate\r\n\r\nclass TimerNode(Node):\r\n    def __init__(self):\r\n        super().__init__('timer_node')\r\n\r\n        # Multiple timers with different periods\r\n        self.timer_100ms = self.create_timer(0.1, self.timer_100ms_callback)\r\n        self.timer_500ms = self.create_timer(0.5, self.timer_500ms_callback)\r\n        self.timer_1s = self.create_timer(1.0, self.timer_1s_callback)\r\n\r\n        # Timer with rate limiting\r\n        self.counter = 0\r\n        self.rate_timer = self.create_rate(10)  # 10 Hz\r\n\r\n    def timer_100ms_callback(self):\r\n        self.get_logger().info('100ms timer callback')\r\n\r\n    def timer_500ms_callback(self):\r\n        self.get_logger().info('500ms timer callback')\r\n\r\n    def timer_1s_callback(self):\r\n        self.get_logger().info('1s timer callback')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TimerNode()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"exception-handling-and-error-management",children:"Exception Handling and Error Management"}),"\n",(0,i.jsx)(r.h3,{id:"robust-error-handling",children:"Robust Error Handling"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\nimport traceback\r\n\r\nclass RobustNode(Node):\r\n    def __init__(self):\r\n        super().__init__('robust_node')\r\n\r\n        self.publisher_ = self.create_publisher(String, 'robust_topic', 10)\r\n        self.timer = self.create_timer(0.1, self.robust_timer_callback)\r\n        self.error_count = 0\r\n\r\n    def robust_timer_callback(self):\r\n        try:\r\n            # Risky operation\r\n            msg = String()\r\n            msg.data = f'Robust message: {100 / (10 - self.error_count)}'\r\n            self.publisher_.publish(msg)\r\n            self.error_count = 0  # Reset on success\r\n\r\n        except ZeroDivisionError:\r\n            self.error_count += 1\r\n            self.get_logger().error('Division by zero error occurred')\r\n\r\n        except Exception as e:\r\n            self.error_count += 1\r\n            self.get_logger().error(f'Unexpected error: {str(e)}')\r\n            self.get_logger().error(traceback.format_exc())\r\n\r\n        finally:\r\n            # Cleanup operations\r\n            pass\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = RobustNode()\r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        node.get_logger().info('Interrupted by user')\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"package-structure-and-organization",children:"Package Structure and Organization"}),"\n",(0,i.jsx)(r.h3,{id:"creating-a-ros-2-python-package",children:"Creating a ROS 2 Python Package"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"my_robot_package/\r\n\u251c\u2500\u2500 CMakeLists.txt\r\n\u251c\u2500\u2500 package.xml\r\n\u251c\u2500\u2500 setup.py\r\n\u251c\u2500\u2500 setup.cfg\r\n\u251c\u2500\u2500 resource/\r\n\u2502   \u2514\u2500\u2500 my_robot_package\r\n\u251c\u2500\u2500 test/\r\n\u2502   \u2514\u2500\u2500 test_copyright.py\r\n\u2502   \u2514\u2500\u2500 test_flake8.py\r\n\u2502   \u2514\u2500\u2500 test_pep257.py\r\n\u2502   \u2514\u2500\u2500 test_my_robot_package.py\r\n\u2514\u2500\u2500 my_robot_package/\r\n    \u251c\u2500\u2500 __init__.py\r\n    \u251c\u2500\u2500 publisher_member_function.py\r\n    \u251c\u2500\u2500 subscriber_member_function.py\r\n    \u2514\u2500\u2500 service_member_function.py\n"})}),"\n",(0,i.jsx)(r.h3,{id:"setuppy-for-python-package",children:"setup.py for Python Package"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"from setuptools import setup\r\n\r\npackage_name = 'my_robot_package'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.0.0',\r\n    packages=[package_name],\r\n    data_files=[\r\n        ('share/ament_index/resource_index/packages',\r\n            ['resource/' + package_name]),\r\n        ('share/' + package_name, ['package.xml']),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='Your Name',\r\n    maintainer_email='your.email@example.com',\r\n    description='A Python package for my robot',\r\n    license='Apache License 2.0',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'talker = my_robot_package.publisher_member_function:main',\r\n            'listener = my_robot_package.subscriber_member_function:main',\r\n        ],\r\n    },\r\n)\n"})}),"\n",(0,i.jsx)(r.h2,{id:"debugging-techniques",children:"Debugging Techniques"}),"\n",(0,i.jsx)(r.h3,{id:"debugging-with-logging",children:"Debugging with Logging"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.logging import LoggingSeverity\r\n\r\nclass DebugNode(Node):\r\n    def __init__(self):\r\n        super().__init__('debug_node')\r\n\r\n        # Set logging level\r\n        self.get_logger().set_level(LoggingSeverity.DEBUG)\r\n\r\n        # Different logging levels\r\n        self.get_logger().debug('Debug message')\r\n        self.get_logger().info('Info message')\r\n        self.get_logger().warn('Warning message')\r\n        self.get_logger().error('Error message')\r\n        self.get_logger().fatal('Fatal message')\r\n\r\n        # Log structured data\r\n        self.debug_var = 42\r\n        self.get_logger().info(f'Debug variable value: {self.debug_var}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = DebugNode()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,i.jsx)(r.h3,{id:"efficient-message-handling",children:"Efficient Message Handling"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\nfrom collections import deque\r\nimport time\r\n\r\nclass PerformanceNode(Node):\r\n    def __init__(self):\r\n        super().__init__('performance_node')\r\n\r\n        # Efficient message handling\r\n        self.publisher_ = self.create_publisher(String, 'perf_topic', 10)\r\n        self.subscription = self.create_subscription(\r\n            String, 'perf_topic', self.message_callback, 10\r\n        )\r\n\r\n        # Message queue for batch processing\r\n        self.message_queue = deque(maxlen=100)\r\n\r\n        # Performance monitoring\r\n        self.message_count = 0\r\n        self.start_time = time.time()\r\n\r\n        self.timer = self.create_timer(1.0, self.performance_callback)\r\n\r\n    def message_callback(self, msg):\r\n        # Add to queue for batch processing\r\n        self.message_queue.append(msg.data)\r\n        self.message_count += 1\r\n\r\n        # Process in batches for efficiency\r\n        if len(self.message_queue) >= 10:\r\n            self.process_batch()\r\n\r\n    def process_batch(self):\r\n        # Process multiple messages at once\r\n        while self.message_queue:\r\n            msg_data = self.message_queue.popleft()\r\n            # Process message efficiently\r\n            processed = msg_data.upper()\r\n            self.get_logger().debug(f'Processed: {processed}')\r\n\r\n    def performance_callback(self):\r\n        elapsed = time.time() - self.start_time\r\n        rate = self.message_count / elapsed if elapsed > 0 else 0\r\n        self.get_logger().info(f'Message rate: {rate:.2f} Hz')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = PerformanceNode()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(r.h3,{id:"code-organization",children:"Code Organization"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Use Type Hints"}),": Improve code readability and IDE support"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Follow PEP 8"}),": Maintain Python code style consistency"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Document Functions"}),": Use docstrings for all public functions"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Handle Exceptions"}),": Implement proper error handling"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Resource Management"}),": Clean up resources properly"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Minimize Message Copies"}),": Use efficient message structures"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Choose Appropriate QoS"}),": Match QoS settings to use case"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Batch Processing"}),": Process messages in batches when possible"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Efficient Data Structures"}),": Use appropriate Python data structures"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(r.p,{children:["Continue to ",(0,i.jsx)(r.a,{href:"/physical-ai/docs/module-1/urdf-humanoids",children:"URDF for Humanoids"})," to learn about robot description using URDF."]}),"\n",(0,i.jsx)(r.h2,{id:"learning-objectives-review",children:"Learning Objectives Review"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Master the rclpy client library for ROS 2 Python development \u2713"}),"\n",(0,i.jsx)(r.li,{children:"Create complex nodes with multiple publishers, subscribers, and services \u2713"}),"\n",(0,i.jsx)(r.li,{children:"Implement advanced features like parameters, timers, and callbacks \u2713"}),"\n",(0,i.jsx)(r.li,{children:"Debug and optimize Python-based ROS 2 nodes \u2713"}),"\n",(0,i.jsx)(r.li,{children:"Structure Python packages for ROS 2 projects \u2713"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"practical-exercise",children:"Practical Exercise"}),"\n",(0,i.jsx)(r.p,{children:"Create a complete robot controller node that:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Declares and uses parameters for robot configuration"}),"\n",(0,i.jsx)(r.li,{children:"Publishes sensor data using appropriate QoS settings"}),"\n",(0,i.jsx)(r.li,{children:"Subscribes to command topics and processes them"}),"\n",(0,i.jsx)(r.li,{children:"Provides services for robot control"}),"\n",(0,i.jsx)(r.li,{children:"Implements proper error handling and logging"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"assessment-questions",children:"Assessment Questions"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"What is the difference between rclpy and rcl?"}),"\n",(0,i.jsx)(r.li,{children:"How do you declare and use parameters in rclpy?"}),"\n",(0,i.jsx)(r.li,{children:"Explain the difference between synchronous and asynchronous service calls."}),"\n",(0,i.jsx)(r.li,{children:"What are the best practices for organizing ROS 2 Python packages?"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["rclpy Documentation: ",(0,i.jsx)(r.a,{href:"https://docs.ros.org/en/humble/p/rclpy/",children:"https://docs.ros.org/en/humble/p/rclpy/"})]}),"\n",(0,i.jsxs)(r.li,{children:["ROS 2 Python Tutorials: ",(0,i.jsx)(r.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html",children:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"})]}),"\n",(0,i.jsxs)(r.li,{children:["Python Style Guide: ",(0,i.jsx)(r.a,{href:"https://docs.ros.org/en/humble/The-ROS2-Project/Contributing/Code-Style-Language-Versions.html",children:"https://docs.ros.org/en/humble/The-ROS2-Project/Contributing/Code-Style-Language-Versions.html"})]}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,r,n){n.d(r,{R:()=>t,x:()=>a});var s=n(6540);const i={},l=s.createContext(i);function t(e){const r=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:r},e.children)}}}]);